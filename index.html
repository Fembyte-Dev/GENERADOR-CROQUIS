<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Croquis de Terreno</title>
    <style>
        :root {
            --primary-color: #3498db;
            --primary-dark: #2980b9;
            --background-color: #f5f5f5;
            --card-bg: white;
            --border-color: #ddd;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --spacing-xs: 5px;
            --spacing-sm: 10px;
            --spacing-md: 15px;
            --spacing-lg: 20px;
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', 'Arial', sans-serif;
            background-color: var(--background-color);
            color: #333;
            line-height: 1.6;
            padding: var(--spacing-md);
        }

        .page-title {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }

        .card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .card-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            text-align: center;
        }

        .card-body {
            padding: var(--spacing-lg);
        }

        /* Form Styling */
        .form-section {
            margin-bottom: var(--spacing-lg);
        }

        .section-title {
            margin-bottom: var(--spacing-md);
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            font-size: 1.2rem;
            color: #444;
        }
        .form-grid {
            display: grid;
            gap: var(--spacing-md);
        }

        .colindancias-grid {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .colores-grid {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }

        .offset-grid {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .form-group {
            margin-bottom: var(--spacing-sm);
        }

        .form-control {
            display: flex;
            flex-direction: column;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #555;
        }

        input,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            transition: var(--transition);
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        input[type="color"] {
            height: 40px;
            padding: 2px;
        }

        input[type="range"] {
            margin-bottom: var(--spacing-xs);
        }

        .range-value {
            font-size: 0.9rem;
            color: #666;
        }

        /* Buttons */
        .btn-container {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
            justify-content: center;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn i {
            font-size: 18px;
        }

        /* Output Section */
        .canvas-container {
            padding: var(--spacing-lg);
            display: flex;
            justify-content: center;
            position: relative;
            overflow-x: auto;
        }

        canvas {
            border: 1px solid var(--border-color);
            background-color: #fff;
            max-width: 100%;
        }

        .legend {
            margin-top: var(--spacing-lg);
            padding: var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: #f9f9f9;
        }

        .legend-title {
            margin-bottom: var(--spacing-sm);
            font-weight: 600;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .color-box {
            width: 20px;
            height: 20px;
            margin-right: var(--spacing-sm);
            border: 1px solid #ccc;
        }

        .info-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--spacing-lg);
        }

        .info-table th,
        .info-table td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }

        .info-table th {
            background-color: #f2f2f2;
            font-weight: 600;
        }

        .info-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .scale-info {
            text-align: center;
            margin-top: var(--spacing-lg);
            font-style: italic;
            color: #666;
        }

        .footer {
            text-align: center;
            margin-top: var(--spacing-lg);
            color: #777;
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .input-output-container {
                display: flex;
                gap: var(--spacing-lg);
            }

            .input-section,
            .output-section {
                flex: 1;
            }
        }

        @media (max-width: 767px) {

            .input-section,
            .output-section {
                margin-bottom: var(--spacing-lg);
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .btn-container {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Print Styles */
        @media print {

            .input-section,
            .no-print {
                display: none;
            }

            body {
                background-color: white;
                padding: 0;
            }

            .output-section {
                box-shadow: none;
                margin: 0;
            }

            .page-title {
                display: none;
            }
        }

        .hidden {
            display: none;
        }

        /* Collapsible panels for mobile */
        .collapse-toggle {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .collapse-toggle::after {
            content: '\f078';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            transition: var(--transition);
        }

        .collapse-toggle.collapsed::after {
            transform: rotate(180deg);
        }

        .collapsible-content {
            transition: max-height 0.3s ease;
            overflow: hidden;
        }

        .collapsible-content.collapsed {
            max-height: 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="input-output-container">
            <!-- Sección de entrada de datos -->
            <div class="input-section card">
                <div class="card-header">
                    <h2>Datos del Terreno</h2>
                </div>
                <div class="card-body">
                    <!-- Título del croquis -->
                    <div class="form-section">
                        <div class="form-group">
                            <label for="title">Título del Croquis:</label>
                            <input type="text" id="title" class="form-control" value="Croquis de Terreno - Medidas y Colindancias">
                        </div>
                    </div>
                    
                    <!-- Medidas y Colindancias -->
                    <div class="form-section">
                        <h3 class="section-title collapse-toggle">Medidas y Colindancias</h3>
                        <div class="collapsible-content">
                            <div class="form-grid colindancias-grid">
                                <!-- Norte -->
                                <div class="form-group">
                                    <div class="form-control">
                                        <label for="northMeasure">NORTE (metros):</label>
                                        <input type="number" id="northMeasure" step="0.01" value="120.00">
                                    </div>
                                    <div class="form-control">
                                        <label for="northNeighbor">Colindancia NORTE:</label>
                                        <input type="text" id="northNeighbor" value="Calle ejemplo">
                                    </div>
                                </div>
                                
                                <!-- Sur -->
                                <div class="form-group">
                                    <div class="form-control">
                                        <label for="southMeasure">SUR (metros):</label>
                                        <input type="number" id="southMeasure" step="0.01" value="116.00">
                                    </div>
                                    <div class="form-control">
                                        <label for="southNeighbor">Colindancia SUR:</label>
                                        <input type="text" id="southNeighbor" value="Calle ejemplo">
                                    </div>
                                </div>
                                
                                <!-- Oriente -->
                                <div class="form-group">
                                    <div class="form-control">
                                        <label for="eastMeasure">ORIENTE (metros):</label>
                                        <input type="number" id="eastMeasure" step="0.01" value="285.00">
                                    </div>
                                    <div class="form-control">
                                        <label for="eastNeighbor">Colindancia ORIENTE:</label>
                                        <input type="text" id="eastNeighbor" value="Calle ejemplo">
                                    </div>
                                </div>
                                
                                <!-- Poniente -->
                                <div class="form-group">
                                    <div class="form-control">
                                        <label for="westMeasure">PONIENTE (metros):</label>
                                        <input type="number" id="westMeasure" step="0.01" value="285.00">
                                    </div>
                                    <div class="form-control">
                                        <label for="westNeighbor">Colindancia PONIENTE:</label>
                                        <input type="text" id="westNeighbor" value="Calle ejemplo">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Colores -->
                    <div class="form-section">
                        <h3 class="section-title collapse-toggle">Colores</h3>
                        <div class="collapsible-content">
                            <div class="form-grid colores-grid">
                                <div class="form-group">
                                    <label for="northColor">Color NORTE:</label>
                                    <input type="color" id="northColor" value="#FF6B6B">
                                </div>
                                
                                <div class="form-group">
                                    <label for="southColor">Color SUR:</label>
                                    <input type="color" id="southColor" value="#4ECDC4">
                                </div>
                                
                                <div class="form-group">
                                    <label for="eastColor">Color ORIENTE:</label>
                                    <input type="color" id="eastColor" value="#FFD166">
                                </div>
                                
                                <div class="form-group">
                                    <label for="westColor">Color PONIENTE:</label>
                                    <input type="color" id="westColor" value="#6A0572">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configuración del croquis -->
                    <div class="form-section">
                        <h3 class="section-title collapse-toggle">Configuración avanzada</h3>
                        <div class="collapsible-content">
                            <div class="form-group">
                                <label for="marginSize">Margen (px):</label>
                                <input type="range" id="marginSize" min="10" max="200" step="5" value="50">
                                <span id="marginValue" class="range-value">50 px</span>
                            </div>
                            
                            <h4 class="sub-section-title">Ajuste de textos:</h4>
                            
                            <!-- Norte -->
                            <div class="form-grid offset-grid">
                                <div class="form-group">
                                    <label for="northMeasureOffset">Offset texto medida NORTE:</label>
                                    <input type="range" id="northMeasureOffset" min="-50" max="50" step="5" value="-15">
                                    <span id="northMeasureOffsetValue" class="range-value">-15 px</span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="northNeighborOffset">Offset colindancia NORTE:</label>
                                    <input type="range" id="northNeighborOffset" min="-100" max="100" step="5" value="-40">
                                    <span id="northNeighborOffsetValue" class="range-value">-40 px</span>
                                </div>
                            </div>
                            
                            <!-- Sur -->
                            <div class="form-grid offset-grid">
                                <div class="form-group">
                                    <label for="southMeasureOffset">Offset texto medida SUR:</label>
                                    <input type="range" id="southMeasureOffset" min="-50" max="50" step="5" value="25">
                                    <span id="southMeasureOffsetValue" class="range-value">25 px</span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="southNeighborOffset">Offset colindancia SUR:</label>
                                    <input type="range" id="southNeighborOffset" min="-100" max="100" step="5" value="40">
                                    <span id="southNeighborOffsetValue" class="range-value">40 px</span>
                                </div>
                            </div>
                            
                            <!-- Oriente -->
                            <div class="form-grid offset-grid">
                                <div class="form-group">
                                    <label for="eastMeasureOffset">Offset texto medida ORIENTE:</label>
                                    <input type="range" id="eastMeasureOffset" min="-100" max="100" step="5" value="45">
                                    <span id="eastMeasureOffsetValue" class="range-value">45 px</span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="eastNeighborOffset">Offset colindancia ORIENTE:</label>
                                    <input type="range" id="eastNeighborOffset" min="-100" max="100" step="5" value="30">
                                    <span id="eastNeighborOffsetValue" class="range-value">30 px</span>
                                </div>
                            </div>
                            
                            <!-- Poniente -->
                            <div class="form-grid offset-grid">
                                <div class="form-group">
                                    <label for="westMeasureOffset">Offset texto medida PONIENTE:</label>
                                    <input type="range" id="westMeasureOffset" min="-100" max="100" step="5" value="-45">
                                    <span id="westMeasureOffsetValue" class="range-value">-45 px</span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="westNeighborOffset">Offset colindancia PONIENTE:</label>
                                    <input type="range" id="westNeighborOffset" min="-100" max="100" step="5" value="-30">
                                    <span id="westNeighborOffsetValue" class="range-value">-30 px</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Botones -->
                    <div class="btn-container">
                        <button id="generateBtn" class="btn"><i class="fas fa-sync-alt"></i> Generar Croquis</button>
                        <button id="printBtn" class="btn no-print"><i class="fas fa-print"></i> Imprimir Croquis</button>
                    </div>
                </div>
            </div>
            
            <!-- Sección de salida (resultado) -->
            <div class="output-section card" id="output">
                <div class="card-header" id="outputHeader">
                    <h2 id="outputTitle">Croquis de Terreno - Medidas y Colindancias</h2>
                </div>
                <div class="card-body">
                    <div class="canvas-container">
                        <canvas id="terrainMap" width="800" height="600"></canvas>
                    </div>
                    
                    <div class="legend" id="legendContainer">
                        <h3 class="legend-title">Colindancias:</h3>
                        <!-- Se generará dinámicamente -->
                    </div>
                    
                    <p class="scale-info">Escala gráfica aproximada. Este croquis es ilustrativo.</p>
                    
                    <table class="info-table">
                        <thead>
                            <tr>
                                <th>Orientación</th>
                                <th>Medida</th>
                                <th>Colindancia</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            <!-- Se generará dinámicamente -->
                        </tbody>
                    </table>
                    
                    <div class="footer">
                        <p id="areaInfo">Superficie aproximada: 0 m² (Calculada en base a las medidas proporcionadas)</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const generateBtn = document.getElementById('generateBtn');
            const printBtn = document.getElementById('printBtn');
            const output = document.getElementById('output');
            const marginSlider = document.getElementById('marginSize');
            const marginValue = document.getElementById('marginValue');

            // Generar el croquis automáticamente al cargar la página
            generateCroquis();

            // Función de debounce para limitar la frecuencia de actualización
            function debounce(func, wait) {
                let timeout;
                return function () {
                    const context = this;
                    const args = arguments;
                    clearTimeout(timeout);
                    timeout = setTimeout(function () {
                        func.apply(context, args);
                    }, wait);
                };
            }

            // Versión con debounce de generateCroquis para mejorar rendimiento
            const debouncedGenerateCroquis = debounce(generateCroquis, 100);

            // Actualizar el valor del margen cuando se mueve el slider
            marginSlider.addEventListener('input', function () {
                marginValue.textContent = this.value;
                debouncedGenerateCroquis(); // Actualizar croquis con debounce
            });

            // Actualizar valores de los offsets cuando se mueven los sliders
            document.getElementById('northMeasureOffset').addEventListener('input', function () {
                document.getElementById('northMeasureOffsetValue').textContent = this.value;
                debouncedGenerateCroquis(); // Actualizar croquis con debounce
            });
            document.getElementById('northNeighborOffset').addEventListener('input', function () {
                document.getElementById('northNeighborOffsetValue').textContent = this.value;
                debouncedGenerateCroquis(); // Actualizar croquis con debounce
            });
            document.getElementById('southMeasureOffset').addEventListener('input', function () {
                document.getElementById('southMeasureOffsetValue').textContent = this.value;
                debouncedGenerateCroquis(); // Actualizar croquis con debounce
            });
            document.getElementById('southNeighborOffset').addEventListener('input', function () {
                document.getElementById('southNeighborOffsetValue').textContent = this.value;
                debouncedGenerateCroquis(); // Actualizar croquis con debounce
            });
            document.getElementById('eastMeasureOffset').addEventListener('input', function () {
                document.getElementById('eastMeasureOffsetValue').textContent = this.value;
                debouncedGenerateCroquis(); // Actualizar croquis con debounce
            });
            document.getElementById('eastNeighborOffset').addEventListener('input', function () {
                document.getElementById('eastNeighborOffsetValue').textContent = this.value;
                debouncedGenerateCroquis(); // Actualizar croquis con debounce
            });
            document.getElementById('westMeasureOffset').addEventListener('input', function () {
                document.getElementById('westMeasureOffsetValue').textContent = this.value;
                debouncedGenerateCroquis(); // Actualizar croquis con debounce
            });
            document.getElementById('westNeighborOffset').addEventListener('input', function () {
                document.getElementById('westNeighborOffsetValue').textContent = this.value;
                debouncedGenerateCroquis(); // Actualizar croquis con debounce
            });

            // Añadir event listeners para actualización automática en los inputs de medidas y colindancias
            document.getElementById('title').addEventListener('input', debouncedGenerateCroquis);
            document.getElementById('northMeasure').addEventListener('input', debouncedGenerateCroquis);
            document.getElementById('southMeasure').addEventListener('input', debouncedGenerateCroquis);
            document.getElementById('eastMeasure').addEventListener('input', debouncedGenerateCroquis);
            document.getElementById('westMeasure').addEventListener('input', debouncedGenerateCroquis);
            document.getElementById('northNeighbor').addEventListener('input', debouncedGenerateCroquis);
            document.getElementById('southNeighbor').addEventListener('input', debouncedGenerateCroquis);
            document.getElementById('eastNeighbor').addEventListener('input', debouncedGenerateCroquis);
            document.getElementById('westNeighbor').addEventListener('input', debouncedGenerateCroquis);
            document.getElementById('northColor').addEventListener('input', debouncedGenerateCroquis);
            document.getElementById('southColor').addEventListener('input', debouncedGenerateCroquis);
            document.getElementById('eastColor').addEventListener('input', debouncedGenerateCroquis);
            document.getElementById('westColor').addEventListener('input', debouncedGenerateCroquis);

            generateBtn.addEventListener('click', generateCroquis);
            printBtn.addEventListener('click', function () {
                window.print();
            });

            // Función optimizada para generar el croquis
            function generateCroquis() {
                // Mostrar sección de salida
                output.classList.remove('hidden');

                // Obtener valores usando destructuring para mayor legibilidad
                const title = document.getElementById('title').value;

                // Medidas
                const northMeasure = parseFloat(document.getElementById('northMeasure').value);
                const southMeasure = parseFloat(document.getElementById('southMeasure').value);
                const eastMeasure = parseFloat(document.getElementById('eastMeasure').value);
                const westMeasure = parseFloat(document.getElementById('westMeasure').value);

                // Colindancias
                const northNeighbor = document.getElementById('northNeighbor').value;
                const southNeighbor = document.getElementById('southNeighbor').value;
                const eastNeighbor = document.getElementById('eastNeighbor').value;
                const westNeighbor = document.getElementById('westNeighbor').value;

                // Colores
                const northColor = document.getElementById('northColor').value;
                const southColor = document.getElementById('southColor').value;
                const eastColor = document.getElementById('eastColor').value;
                const westColor = document.getElementById('westColor').value;

                // Configuración
                const marginSize = parseInt(document.getElementById('marginSize').value);

                // Offsets para textos
                const northMeasureOffset = parseInt(document.getElementById('northMeasureOffset').value);
                const northNeighborOffset = parseInt(document.getElementById('northNeighborOffset').value);
                const southMeasureOffset = parseInt(document.getElementById('southMeasureOffset').value);
                const southNeighborOffset = parseInt(document.getElementById('southNeighborOffset').value);
                const eastMeasureOffset = parseInt(document.getElementById('eastMeasureOffset').value);
                const eastNeighborOffset = parseInt(document.getElementById('eastNeighborOffset').value);
                const westMeasureOffset = parseInt(document.getElementById('westMeasureOffset').value);
                const westNeighborOffset = parseInt(document.getElementById('westNeighborOffset').value);

                // Actualizar título
                document.getElementById('outputTitle').textContent = title;

                // Generar tabla de datos
                const tableBody = document.getElementById('tableBody');
                tableBody.innerHTML = '';

                const rows = [
                    { orientation: 'NORTE', measure: northMeasure.toFixed(2), neighbor: northNeighbor },
                    { orientation: 'SUR', measure: southMeasure.toFixed(2), neighbor: southNeighbor },
                    { orientation: 'ORIENTE', measure: eastMeasure.toFixed(2), neighbor: eastNeighbor },
                    { orientation: 'PONIENTE', measure: westMeasure.toFixed(2), neighbor: westNeighbor }
                ];

                rows.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${row.orientation}</td>
                        <td>${row.measure} mts.</td>
                        <td>${row.neighbor}</td>
                    `;
                    tableBody.appendChild(tr);
                });

                // Generar leyenda
                const legendContainer = document.getElementById('legendContainer');
                legendContainer.innerHTML = '<h3>Colindancias:</h3>';

                const references = [
                    { color: northColor, text: `NORTE: ${northMeasure.toFixed(2)} mts. con ${northNeighbor}` },
                    { color: southColor, text: `SUR: ${southMeasure.toFixed(2)} mts. con ${southNeighbor}` },
                    { color: eastColor, text: `ORIENTE: ${eastMeasure.toFixed(2)} mts. con ${eastNeighbor}` },
                    { color: westColor, text: `PONIENTE: ${westMeasure.toFixed(2)} mts. con ${westNeighbor}` }
                ];

                references.forEach(ref => {
                    const div = document.createElement('div');
                    div.className = 'reference';
                    div.innerHTML = `
                        <div class="color-box" style="background-color: ${ref.color};"></div>
                        <span>${ref.text}</span>
                    `;
                    legendContainer.appendChild(div);
                });

                // Calcular y mostrar área
                const area = calculateArea(northMeasure, southMeasure, eastMeasure, westMeasure);
                document.getElementById('areaInfo').textContent =
                    `Superficie aproximada: ${area.toLocaleString()} m² (Calculada en base a las medidas proporcionadas)`;

                // Dibujar el croquis
                drawCroquis(
                    northMeasure, southMeasure, eastMeasure, westMeasure,
                    northNeighbor, southNeighbor, eastNeighbor, westNeighbor,
                    northColor, southColor, eastColor, westColor,
                    marginSize,
                    northMeasureOffset, southMeasureOffset, eastMeasureOffset, westMeasureOffset,
                    northNeighborOffset, southNeighborOffset, eastNeighborOffset, westNeighborOffset
                );
            }

            function calculateArea(north, south, east, west) {
                // Usando la fórmula del área del trapecio: A = (b1 + b2) * h / 2
                const height = (east + west) / 2;
                const area = (north + south) * height / 2;
                return Math.round(area);
            }

            function drawCroquis(northSide, southSide, eastSide, westSide,
                northNeighbor, southNeighbor, eastNeighbor, westNeighbor,
                northColor, southColor, eastColor, westColor,
                margin,
                northMeasureOffset, southMeasureOffset, eastMeasureOffset, westMeasureOffset,
                northNeighborOffset, southNeighborOffset, eastNeighborOffset, westNeighborOffset) {
                const canvas = document.getElementById('terrainMap');
                const ctx = canvas.getContext('2d');

                // Limpiar canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Definir margen y escala
                const totalWidth = (northSide + southSide) / 2;
                const totalHeight = (eastSide + westSide) / 2;

                const scaleX = (canvas.width - 2 * margin) / totalWidth;
                const scaleY = (canvas.height - 2 * margin) / totalHeight;
                const scale = Math.min(scaleX, scaleY);

                const startX = (canvas.width - (totalWidth * scale)) / 2;
                const startY = (canvas.height - (totalHeight * scale)) / 2;

                // Puntos del polígono
                const points = [
                    { x: startX, y: startY }, // Esquina noroeste
                    { x: startX + northSide * scale, y: startY }, // Esquina noreste
                    { x: startX + northSide * scale, y: startY + eastSide * scale }, // Esquina sureste
                    { x: startX + (northSide - southSide) * scale, y: startY + westSide * scale } // Esquina suroeste
                ];

                // Dibujar el polígono
                ctx.beginPath();
                ctx.moveTo(points[0].x, points[0].y);
                ctx.lineTo(points[1].x, points[1].y);
                ctx.lineTo(points[2].x, points[2].y);
                ctx.lineTo(points[3].x, points[3].y);
                ctx.closePath();
                ctx.fillStyle = 'rgba(240, 240, 240, 0.5)';
                ctx.fill();

                // Colores para cada lado
                const colors = [northColor, southColor, eastColor, westColor];

                // Dibujar y etiquetar cada lado
                drawSide(points[0], points[1], northSide, 'NORTE', colors[0], 0, northMeasureOffset);
                drawSide(points[3], points[2], southSide, 'SUR', colors[1], 0, southMeasureOffset);
                drawSide(points[1], points[2], eastSide, 'ORIENTE', colors[2], Math.PI / 2, eastMeasureOffset);
                drawSide(points[0], points[3], westSide, 'PONIENTE', colors[3], Math.PI / 2, westMeasureOffset);

                // Dibujar textos de colindancias
                ctx.font = '12px Arial';
                ctx.fillStyle = '#333';
                ctx.textAlign = 'center';

                // Colindancias
                drawColindancia(points[0], points[1], northNeighbor, northNeighborOffset);
                drawColindancia(points[3], points[2], southNeighbor, southNeighborOffset);
                drawColindancia(points[1], points[2], eastNeighbor, eastNeighborOffset);
                drawColindancia(points[0], points[3], westNeighbor, westNeighborOffset);

                // Dibujar brújula
                drawCompass(canvas.width - 100, 100, 40);

                // Dibujar esquinas con puntos
                points.forEach(p => {
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, 5, 0, Math.PI * 2);
                    ctx.fillStyle = '#333';
                    ctx.fill();
                });

                // Función para dibujar un lado
                function drawSide(start, end, length, orientation, color, angleOffset, textOffset) {
                    // Dibujar línea
                    ctx.beginPath();
                    ctx.moveTo(start.x, start.y);
                    ctx.lineTo(end.x, end.y);
                    ctx.lineWidth = 4;
                    ctx.strokeStyle = color;
                    ctx.stroke();

                    // Dibujar medida
                    const midX = (start.x + end.x) / 2;
                    const midY = (start.y + end.y) / 2;

                    // Calcular ángulo
                    let angle = Math.atan2(end.y - start.y, end.x - start.x) + angleOffset;

                    // Ajustar posición del texto
                    let offsetX = 0;
                    let offsetY = 0;

                    if (orientation === 'NORTE') {
                        offsetY = textOffset; // Usar el offset personalizado
                    } else if (orientation === 'SUR') {
                        offsetY = textOffset; // Usar el offset personalizado
                    } else if (orientation === 'ORIENTE') {
                        offsetX = textOffset; // Usar el offset personalizado
                    } else if (orientation === 'PONIENTE') {
                        offsetX = textOffset; // Usar el offset personalizado
                    }

                    // Añadir fondo para el texto
                    ctx.save();
                    ctx.translate(midX + offsetX, midY + offsetY);

                    // Determinar si necesitamos rotar el texto para que sea legible
                    let needsRotation = false;
                    let rotationAngle = angle;

                    if (orientation === 'ORIENTE' || orientation === 'PONIENTE') {
                        // Para lados verticales, siempre rotamos
                        needsRotation = true;

                        // Ajustar el ángulo para que el texto siempre sea legible (de izquierda a derecha)
                        // Si el ángulo está en el rango de -PI a 0 o PI/2 a 3PI/2, invertimos la rotación
                        if ((rotationAngle > -Math.PI && rotationAngle < 0) ||
                            (rotationAngle > Math.PI / 2 && rotationAngle < 3 * Math.PI / 2)) {
                            rotationAngle += Math.PI; // Girar 180 grados
                        }
                    }

                    if (needsRotation) {
                        ctx.rotate(rotationAngle);
                    }

                    const textMeasure = `${length.toFixed(2)} m`;
                    const metrics = ctx.measureText(textMeasure);
                    const padding = 5;

                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.fillRect(
                        -metrics.width / 2 - padding,
                        -15 - padding,
                        metrics.width + padding * 2,
                        20 + padding * 2
                    );

                    // Dibujar texto
                    ctx.font = 'bold 14px Arial';
                    ctx.fillStyle = '#333';
                    ctx.textAlign = 'center';
                    ctx.fillText(textMeasure, 0, 0);
                    ctx.restore();

                    // Añadir flechas
                    drawArrow(start, end, color);
                }

                // Función para dibujar flechas
                function drawArrow(start, end, color) {
                    const headLength = 15;
                    const headAngle = Math.PI / 6;

                    // Calcular ángulo
                    const angle = Math.atan2(end.y - start.y, end.x - start.x);

                    // Dibujar punta de flecha en el inicio
                    ctx.beginPath();
                    ctx.moveTo(start.x, start.y);
                    ctx.lineTo(
                        start.x + headLength * Math.cos(angle + Math.PI - headAngle),
                        start.y + headLength * Math.sin(angle + Math.PI - headAngle)
                    );
                    ctx.moveTo(start.x, start.y);
                    ctx.lineTo(
                        start.x + headLength * Math.cos(angle + Math.PI + headAngle),
                        start.y + headLength * Math.sin(angle + Math.PI + headAngle)
                    );
                    ctx.lineWidth = 2;
                    ctx.strokeStyle = color;
                    ctx.stroke();

                    // Dibujar punta de flecha en el final
                    ctx.beginPath();
                    ctx.moveTo(end.x, end.y);
                    ctx.lineTo(
                        end.x + headLength * Math.cos(angle - headAngle),
                        end.y + headLength * Math.sin(angle - headAngle)
                    );
                    ctx.moveTo(end.x, end.y);
                    ctx.lineTo(
                        end.x + headLength * Math.cos(angle + headAngle),
                        end.y + headLength * Math.sin(angle + headAngle)
                    );
                    ctx.lineWidth = 2;
                    ctx.strokeStyle = color;
                    ctx.stroke();
                }

                // Función para dibujar colindancias
                function drawColindancia(start, end, text, offset) {
                    const midX = (start.x + end.x) / 2;
                    const midY = (start.y + end.y) / 2;

                    // Calcular ángulo
                    const angle = Math.atan2(end.y - start.y, end.x - start.x);

                    // Calcular offset perpendicular
                    const perpX = -Math.sin(angle) * offset;
                    const perpY = Math.cos(angle) * offset;

                    // Dibujar fondo para el texto
                    ctx.save();
                    ctx.translate(midX + perpX, midY + perpY);

                    // Rotar texto
                    if (Math.abs(angle - Math.PI / 2) < 0.1 || Math.abs(angle + Math.PI / 2) < 0.1) {
                        ctx.rotate(angle);
                    }

                    // Medir texto
                    const metrics = ctx.measureText(text);
                    const padding = 5;

                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.fillRect(
                        -metrics.width / 2 - padding,
                        -10 - padding,
                        metrics.width + padding * 2,
                        20 + padding * 2
                    );

                    // Dibujar texto
                    ctx.font = 'italic 12px Arial';
                    ctx.fillStyle = '#333';
                    ctx.textAlign = 'center';
                    ctx.fillText(text, 0, 0);
                    ctx.restore();
                }

                // Función para dibujar la brújula
                function drawCompass(x, y, radius) {
                    // Círculo exterior
                    ctx.beginPath();
                    ctx.arc(x, y, radius, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                    ctx.fill();
                    ctx.lineWidth = 1;
                    ctx.strokeStyle = '#333';
                    ctx.stroke();

                    // Flecha Norte
                    ctx.beginPath();
                    ctx.moveTo(x, y - radius + 5);
                    ctx.lineTo(x - 8, y);
                    ctx.lineTo(x, y + 5);
                    ctx.lineTo(x + 8, y);
                    ctx.closePath();
                    ctx.fillStyle = '#DD3333';
                    ctx.fill();
                    ctx.strokeStyle = '#333';
                    ctx.stroke();

                    // Letras para los puntos cardinales
                    ctx.font = 'bold 12px Arial';
                    ctx.fillStyle = '#333';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('N', x, y - radius / 2);
                    ctx.fillText('S', x, y + radius / 2);
                    ctx.fillText('E', x + radius / 2, y);
                    ctx.fillText('O', x - radius / 2, y);
                }
            }

            // Generar croquis con los valores iniciales
            generateCroquis();
            
            // Actualizar valores de los rangos
            document.querySelectorAll('input[type="range"]').forEach(range => {
                const valueSpan = document.getElementById(range.id + 'Value');
                if (valueSpan) {
                    range.addEventListener('input', () => {
                        valueSpan.textContent = range.value + ' px';
                    });
                }
            });
            
            // Toggle para secciones colapsables en móvil
            document.querySelectorAll('.collapse-toggle').forEach(toggle => {
                toggle.addEventListener('click', () => {
                    toggle.classList.toggle('collapsed');
                    const content = toggle.nextElementSibling;
                    if (content.classList.contains('collapsed')) {
                        content.classList.remove('collapsed');
                        content.style.maxHeight = content.scrollHeight + "px";
                    } else {
                        content.classList.add('collapsed');
                        content.style.maxHeight = "0";
                    }
                });
                
                // Inicialmente expandido
                const content = toggle.nextElementSibling;
                content.style.maxHeight = content.scrollHeight + "px";
            });
            
            // Actualizar leyenda
            function updateLegend() {
                const legend = document.getElementById('legendContainer');
                legend.innerHTML = '<h3 class="legend-title">Colindancias:</h3>';
                
                const directions = [
                    { name: 'NORTE', color: document.getElementById('northColor').value, neighbor: document.getElementById('northNeighbor').value },
                    { name: 'SUR', color: document.getElementById('southColor').value, neighbor: document.getElementById('southNeighbor').value },
                    { name: 'ORIENTE', color: document.getElementById('eastColor').value, neighbor: document.getElementById('eastNeighbor').value },
                    { name: 'PONIENTE', color: document.getElementById('westColor').value, neighbor: document.getElementById('westNeighbor').value }
                ];
                
                directions.forEach(dir => {
                    const item = document.createElement('div');
                    item.className = 'legend-item';
                    
                    const colorBox = document.createElement('span');
                    colorBox.className = 'color-box';
                    colorBox.style.backgroundColor = dir.color;
                    
                    const text = document.createElement('span');
                    text.textContent = `${dir.name}: ${dir.neighbor}`;
                    
                    item.appendChild(colorBox);
                    item.appendChild(text);
                    legend.appendChild(item);
                });
            }
        });
    
    </script>
</body>

</html>